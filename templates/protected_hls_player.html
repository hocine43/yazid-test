{% extends "base.html" %}
{% block title %}{{ video.title }}{% endblock %}
{% block content %}

<div class="max-w-4xl mx-auto mt-10 bg-white rounded-xl shadow-lg p-6">
  <h2 class="text-2xl font-bold text-green-700 mb-4">{{ video.title }}</h2>

  <div class="relative">
    <!-- ğŸ¥ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
    <video id="player"
           class="w-full rounded-lg shadow-md bg-black"
           controls
           playsinline
           autoplay
           controlsList="nodownload noremoteplayback"
           disablePictureInPicture>
      <source src="{{ playlist_url }}" type="application/vnd.apple.mpegurl">
      {{ gettext("Votre navigateur ne supporte pas la vidÃ©o.") }}
    </video>

    <!-- ğŸ›‘ ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø­Ù…Ø§ÙŠØ© -->
    <p class="text-xs text-gray-500 italic mt-2">
      ğŸ”’ Cette vidÃ©o est protÃ©gÃ©e contre le tÃ©lÃ©chargement et marquÃ©e dâ€™un filigrane dynamique.
    </p>
  </div>
</div>

<!-- âœ… Ù…ÙƒØªØ¨Ø© HLS.js Ù„ØªØ´ØºÙŠÙ„ Ù…Ù„ÙØ§Øª .m3u8 ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const video = document.getElementById("player");
  const videoSrc = "{{ playlist_url }}";

  // âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… HLS Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
    video.src = videoSrc;
  }

  // ğŸ§ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ 50%
  video.volume = 0.5;

  // ğŸš« ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„ÙŠÙ…ÙŠÙ†ÙŠ + Ø§Ù„Ù†Ø³Ø®
  video.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("keydown", e => {
    if ((e.ctrlKey && e.key === 's') || (e.ctrlKey && e.key === 'u')) e.preventDefault();
  });

  // ğŸ’§ Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø£Ùˆ Ø³Ø­Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙØ­Ø©
  video.addEventListener("dragstart", e => e.preventDefault());
});
</script>

{% endblock %}
